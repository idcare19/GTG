<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-3">
  <div class="container">
    <h1 class="mb-4 text-center">üé• Video Generator Tool</h1>

    <label>Choose Quality:</label>
    <select id="quality" class="form-select mb-3">
      <option value="360p">360p</option>
      <option value="480p">480p</option>
      <option value="720p" selected>720p</option>
      <option value="1080p">1080p</option>
    </select>

    <div id="scenes"></div>

    <button id="addText" class="btn btn-outline-primary mt-2">Add Text Slide</button>
    <button id="addImage" class="btn btn-outline-secondary mt-2">Add Image Slide</button>
    <button id="generate" class="btn btn-success mt-3">Generate Video</button>

    <hr>
    <div id="result" class="mt-3"></div>
  </div>

<script>
const scenesEl = document.getElementById('scenes');

function addScene(type) {
  const div = document.createElement('div');
  div.className = 'card p-2 my-2';
  div.innerHTML = `
    <strong>${type.toUpperCase()} Slide</strong>
    ${type === 'text'
      ? '<textarea class="form-control mb-2" data-key="text" placeholder="Enter text"></textarea>'
      : '<input type="text" class="form-control mb-2" data-key="url" placeholder="Enter image URL">'}
    <input type="number" class="form-control mb-2" data-key="duration" placeholder="Duration (seconds)" value="3">
    <input type="hidden" data-key="type" value="${type}">
    <button class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove</button>
  `;
  scenesEl.appendChild(div);
}

document.getElementById('addText').onclick = () => addScene('text');
document.getElementById('addImage').onclick = () => addScene('image');

document.getElementById('generate').onclick = async () => {
  const quality = document.getElementById('quality').value;
  const cards = scenesEl.querySelectorAll('.card');
  const scenes = Array.from(cards).map(card => {
    const type = card.querySelector('[data-key="type"]').value;
    const duration = parseFloat(card.querySelector('[data-key="duration"]').value);
    const text = card.querySelector('[data-key="text"]')?.value;
    const url = card.querySelector('[data-key="url"]')?.value;
    return { type, duration, text, url };
  });

  document.getElementById('result').innerHTML = "Generating video... ‚è≥";

  const res = await fetch('/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ quality, scenes })
  });

  const data = await res.json();
  if (data.success) {
    document.getElementById('result').innerHTML = `<a href="${data.video}">Download Video üé¨</a>`;
  } else {
    document.getElementById('result').innerHTML = `‚ùå Error: ${data.error}`;
  }
};
</script>
</body>
</html>
